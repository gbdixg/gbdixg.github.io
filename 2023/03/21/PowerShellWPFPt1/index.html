<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Creating a GUI App with PowerShell and WPF - Part 1 Runspaces | Write-Verbose</title><meta name=keywords content="PowerShell,WPF"><meta name=description content="Things I learned creating a GUI tool with PowerShell and WPF.
The snippets in this article are based on the Show-Win32AppUI tool available on GitHub."><meta name=author content="GD"><link rel=canonical href=https://write-verbose.com/2023/03/21/PowerShellWPFPt1/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://write-verbose.com/fav/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://write-verbose.com/fav/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://write-verbose.com/fav/favicon-32x32.png><link rel=apple-touch-icon href=https://write-verbose.com/apple-touch-icon.png><link rel=mask-icon href=https://write-verbose.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-141237050-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Creating a GUI App with PowerShell and WPF - Part 1 Runspaces"><meta property="og:description" content="Things I learned creating a GUI tool with PowerShell and WPF.
The snippets in this article are based on the Show-Win32AppUI tool available on GitHub."><meta property="og:type" content="article"><meta property="og:url" content="https://write-verbose.com/2023/03/21/PowerShellWPFPt1/"><meta property="og:image" content="https://write-verbose.com/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-21T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://write-verbose.com/papermod-cover.png"><meta name=twitter:title content="Creating a GUI App with PowerShell and WPF - Part 1 Runspaces"><meta name=twitter:description content="Things I learned creating a GUI tool with PowerShell and WPF.
The snippets in this article are based on the Show-Win32AppUI tool available on GitHub."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://write-verbose.com/posts/"},{"@type":"ListItem","position":2,"name":"Creating a GUI App with PowerShell and WPF - Part 1 Runspaces","item":"https://write-verbose.com/2023/03/21/PowerShellWPFPt1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Creating a GUI App with PowerShell and WPF - Part 1 Runspaces","name":"Creating a GUI App with PowerShell and WPF - Part 1 Runspaces","description":"Things I learned creating a GUI tool with PowerShell and WPF.\nThe snippets in this article are based on the Show-Win32AppUI tool available on GitHub.\n","keywords":["PowerShell","WPF"],"articleBody":"Things I learned creating a GUI tool with PowerShell and WPF.\nThe snippets in this article are based on the Show-Win32AppUI tool available on GitHub.\nDisclaimer I realise PowerShell isn’t suited to creating GUI apps. The main reason to use PowerShell is supportability. Specifically, when working with Colleagues who aren’t comfortable maintaining a compiled language like C#. Its far easier to make small changes to variables or paths in a script.\nWhy WPF? WPF is a more modern and flexible choice for a UI than the something like WinForms. There are many newer frameworks available, but most require a runtime on the target platform. WPF is easy to deploy as it’s built-into the .NET Framework and available by default on Windows 10/11.\nPart1 - Design the app around PowerShell Runspaces If you try to create a GUI app with a single thread, it will be unresponsive and hang whenever an action takes more than a few seconds. PowerShell runs under a single thread (STA mode) making it unsuitable for a responsive GUI app. However, creating separate Runspaces is a workaround for this problem. Runspaces are analogous to spinning up new PowerShell sessions in the background to execute discrete script blocks.\nWhile Runspaces are effective, they also add a lot of complexity. For example:\nFunctions and variables are not shared between Runspaces by default and have to be imported when the Runspace is started. You should use a thread-safe collection when updating shared variables inside a Runspace. The WPF UI can’t be updated directly from a separate Runspace Writing to a single file from multiple Runspaces requires a locking mechanism, such as a Mutex The lifecycle of Runspaces must be managed, capturing output at completion Warning, Verbose and Error streams in the Runspace are not captured by default Warning, Verbose and Error streams do not appear in the console by default. These concepts are covered in more detail below.\nSharing variables, functions and modules with a Runspace Required modules must be specifically loaded into the InitialSessionState of the Runspace. The Runspace won’t automatically have access to modules already loaded in the parent PowerShell session.\n### Example of importing modules into a new Runspace ### $modulesToLoad=@('Microsoft.Graph.Intune','MSAL.PS') # Must be installed on the computer $initialSessionState = [initialsessionstate]::CreateDefault() foreach($module in $modulesToLoad){ $initialSessionState.ImportPSModule($module) } $Runspace = [runspacefactory]::CreateRunspace($initialSessionState) You can also import standalone Functions into a Runspace using the InitialSessionState. The following imports functions already loaded in the parent session, but you could also load directly from a file on disk.\n### Example importing parent session functions into a new Runspace ### $FunctionsToImport = @('Write-TxtLog','Get-APIResults') foreach($function in $functionsToImport){ $definition = Get-Content \"Function:\\$Function\" $entry = New-Object System.Management.Automation.Runspaces.SessionStateFunctionEntry -ArgumentList $function, $definition $initialSessionState.Commands.Add($entry) } $Runspace = [runspacefactory]::CreateRunspace($initialSessionState) Variables can be shared with a Runspace using the SetVariable method of the SessionStateProxy class. SetVariable parameters are the variable name (without the ‘$’) and the value to set.\n### Example importing parent session variables into a new Runspace ### $VariablesToImport = @('username','password','displayName') # existing variables in the parent session $Runspace = [runspacefactory]::CreateRunspace($initialSessionState) $Runspace.Open() Foreach($var in $VariablesToImport){ $VarValue = Get-Variable -Name $Var | Select -ExpandProperty Value $Runspace.SessionStateProxy.SetVariable($Var,$VarValue) } Runspace output using a thread-safe collection Output from a Runspace can be captured during execution using a thread-safe collection imported from the parent session. When a Runspace updates the collection the updated values are available in the parent session and any concurrent Runspaces that also import the collection. Thread safe collections usually need to be locked during update to prevent conflicts.\nWith a synchronised Arraylist, values added in the Runspace will immediately available to all other Runspaces and the parent session, as in following example:\n### Example using locks on a thread safe collection ### # Parent session code $BackgroundJobs = [system.collections.arraylist]::Synchronized((New-Object System.Collections.ArrayList)) # Thread safe collection $Runspace = [runspacefactory]::CreateRunspace($initialSessionState) $Runspace.Open() $Runspace.SessionStateProxy.SetVariable('BackgroundJobs',$BackgroundJobs) # Pass the variable into the RunSpace $PSCode = [powershell]::Create().AddScript({ # This is the Runspace script block try{ [System.Threading.Monitor]::Enter($BackgroundJobs.SyncRoot) # lock $BackgroundJobs.Add(\"New item\") # modify ArrayList }finally{ [System.Threading.Monitor]::Exit($BackgroundJobs.SyncRoot) # unlock } },$True) $PSCode.Runspace = $Runspace $null = $PSCode.BeginInvoke() There are also Queues and Stacks in .NET that automatically implement locking and don’t need the System.Threading.Monitor code in the above example e.g. a ConcurrentQueue:\n### ConcurrentQueue example - doesn't need System.Threading.Monitor ### # Parent session code $colQueue = [System.Collections.Concurrent.ConcurrentQueue[psobject]]::new() $colQueue.TryAdd([pscustomobject]@{ givenName = 'Bill';sn='Gates'}) $colQueue.TryAdd([pscustomobject]@{ givenName = 'Steve';sn='Jobs'}) $Runspace.SessionStateProxy.SetVariable('colQueue',$colQueue) $PSCode = [powershell]::Create().AddScript({ # This is the Runspace script block # No locking required when ConcurrentQueue is modified in the Runspace $Entry = $null if($colQueue.TryDequeue([ref]$Entry)) { Write-Output $Entry } },$True) More information on thread safe collections is available here\nHow to update the WPF user interface from another Runspace If you try to modify the WPF user interface from a separate Runspace, PowerShell will throw an error indicating only the owning thread (Runspace) can update it.\nThe solution is to wrap the update in a Dispatcher.Invoke method as follows:\n### Example updating a WPF control from another thread (Runspace) ### # In the Runspace script block # txt_SetupFile is a WPF text box created in the parent session of the Runspace $UIControls.txt_SetupFile.Dispatcher.Invoke([action]{ $UIControls.txt_SetupFile.Text = \"Successfully updated from another Runspace\" },\"Normal\") Writing to the same log file from separate Runspaces Runspaces also make it more complex to write to a single log file. There is potential for a deadlock or race condition to occur. A Mutex is one way to implement the required locking:\n### Example using a Mutex lock before writing to a log file ### # In the Runspace script block # LogMutex is an arbitrary name but must be the same when used in any Runspace and the parent session $mtx = New-Object System.Threading.Mutex($false, \"LogMutex\") If ($mtx.WaitOne()){ # Wait until this Runspace can get a lock on the LogMutex object # Lock obtained. Other Runspaces are now waiting try{ Add-Content -Path $logFile -Value $Message -ErrorAction Stop }finally{ [void]$mtx.ReleaseMutex() # release the lock $mtx.Dispose() } } Managing Runspace lifecycle A Runspace executes its script block asynchronously and output (if any) is available at the end. The parent session must manage Runspaces, checking for completion, processing output and ultimately disposing of them. If you don’t dispose of Runspaces they will persist until the parent PowerShell session is closed and could eat-up memory.\nA Timer is a common way to manage Runspaces in an event-driven WPF script. When the Timer event fires, its script blocks checks for Runspace completion as in the example below. A thread safe collection is used to keep track of Runspaces until they are disposed of.\n### Example Timer code to clean-up completed Runspaces ### # Create a collection to track Runspaces $PS = [powershell]::Create().AddScript($codeToRunInRunspace) $handle = $PS.BeginInvoke() # Start the runspace # Add the new Runspace to the RunspaceJobs collection $RunspaceJobs = [system.collections.arraylist]::Synchronized((New-Object System.Collections.ArrayList)) try{ [System.Threading.Monitor]::Enter($RunspaceJobs.SyncRoot) # lock $RunspaceJobs.Add([PSCustomObject]@{ powerShell = $PS # System.Management.Automation.PowerShell object runspace = $handle # System.Management.Automation.PowerShellAsyncResult Object }) | Out-Null }finally{ [System.Threading.Monitor]::Exit($RunspaceJobs.SyncRoot) # unlock } # Timer to manage Runspace lifecycle $RunspaceCleanupTimer = New-Object System.Windows.Forms.Timer $RunspaceCleanupTimer.Enabled = $true $RunspaceCleanupTimer.Interval = 5000 # Timer code runs every 5 seconds $RunspaceCleanupTimer.Add_Tick({ # In the timer code Foreach($job in $Script:RunspaceJobs){ if($job.runspace.IsCompleted -eq $True){ # Capture completed Runspace output and dispose of it to free-up memory try{ $RSOutput = $job.powerShell.EndInvoke($job.runspace) $job.powerShell.runspace.Dispose() # Remove the job from the tracking collection try{ [System.Threading.Monitor]::Enter($Script:RunspaceJobs.SyncRoot) $Script:RunspaceJobs.Remove($job) }finally{ [System.Threading.Monitor]::Exit($Script:RunspaceJobs.SyncRoot) } }catch{ Write-Host \"Runspace disposal Failed '$_'\" } } }#foreach })#End of timer scriptblock $RunspaceCleanupTimer.Start() Capturing Verbose, Warning and Error streams from a Runspace By default, the Runspace output streams are not displayed in the parent session console and are lost when the Runspace is disposed.\nThe output can be captured at Runspace completion using the Streams object. The modification below to the Timer script block saves the output to a log file.\n#### Modified Timer code to capture additional output streams at clean-up #### Foreach($job in $Global:BackgroundJobs){ if($job.runspace.IsCompleted -eq $True){ Write-TxtLog \"Runspace '$($job.powershell.runspace.name)' completed...\" # Could also include 'DEBUG' and 'Information' streams if used in your Runspaces $Streams = @{ 'Verbose'='VERBOSE' 'Warning'='WARN' 'Error'='ERROR' } Foreach($StreamType in $Streams.Keys){ $StreamOutput = $job.powershell.Streams.\"$StreamType\" # Capture the Runspace output for each stream if($StreamOutput){ $StreamOutput | Foreach-Object { Write-TxtLog $_ -indent 2 -severity $($Streams[$StreamType]) } } Remove-Variable -name 'StreamOutput' -force -ErrorAction SilentlyContinue } Write-TxtLog \"Disposing of runspace...\" -indent 1 try{ $RSOutput = $job.powerShell.EndInvoke($job.runspace) $job.powerShell.runspace.Dispose() # Remove the job from the tracking list try{ [System.Threading.Monitor]::Enter($Global:BackgroundJobs.SyncRoot) $Global:BackgroundJobs.Remove($job) }finally{ [System.Threading.Monitor]::Exit($Global:BackgroundJobs.SyncRoot) } }catch{ Write-TxtLog \"Failed '$_'\" -indent 2 -severity ERROR } } }#foreach Displaying Verbose, Warning and Error Streams in the console The approach above captures output when the Runspace code has completed. If you want feedback in the console during execution there are a couple of methods.\nFirstly, the simplest option is to use the .NET Console.Writeline() method. Although this doesn’t capture the PowerShell streams, it is a simple way to provide real-time console output in the parent session.\nYou will need to implement your own colour-coding to distinguish between warnings or errors if needed.\n### Example Runspace code to write to parent PowerShell console ### [console]::ForegroundColor='YELLOW' [Console]::WriteLine('Username was not found') # Automatically writes to the parent session [console]::ResetColor() Alternatively, you could pass the built-in $Host variable from the parent session into the Runspace and use methods like WriteVerboseLine() as shown below.\n### Example writing to parent console using the $Host variable # Parent session code $Runspace = [runspacefactory]::CreateRunspace($initialSessionState) $Runspace.Open() $Runspace.SessionStateProxy.SetVariable('ParentHost',$Host) # Built-in host variable passed into the Runspace as $ParentHost # Write to the parent console from the Runspace script block $ParentHost.ui.WriteVerboseLine(\"Realtime verbose output from Runspace in parent console\") $ParentHost.UI.WriteWarningLine(\"Realtime warning output from Runspace in parent console\") $ParentHost.UI.WriteErrorLine(\"Realtime error output from Runspace in parent console\") See the Show-Win32AppUI tool for an example of using these ideas together in a WPF app.\nSee part2 of this series for information on WPF controls, events and XAML.\nThis article was originally posted on Write-Verbose.com\n","wordCount":"1618","inLanguage":"en","datePublished":"2023-03-21T00:00:00Z","dateModified":"2023-03-21T00:00:00Z","author":{"@type":"Person","name":"GD"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://write-verbose.com/2023/03/21/PowerShellWPFPt1/"},"publisher":{"@type":"Organization","name":"Write-Verbose","logo":{"@type":"ImageObject","url":"https://write-verbose.com/fav/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://write-verbose.com/ accesskey=h title="Write-Verbose (Alt + H)">Write-Verbose</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://write-verbose.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://write-verbose.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://write-verbose.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://write-verbose.com/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://write-verbose.com/>Home</a>&nbsp;»&nbsp;<a href=https://write-verbose.com/posts/>Posts</a></div><h1 class=post-title>Creating a GUI App with PowerShell and WPF - Part 1 Runspaces</h1><div class=post-meta><span title='2023-03-21 00:00:00 +0000 UTC'>March 21, 2023</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;GD</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#disclaimer aria-label=Disclaimer>Disclaimer</a></li><li><a href=#why-wpf aria-label="Why WPF?">Why WPF?</a></li><li><a href=#part1---design-the-app-around-powershell-runspaces aria-label="Part1 - Design the app around PowerShell Runspaces">Part1 - Design the app around PowerShell Runspaces</a><ul><li><a href=#sharing-variables-functions-and-modules-with-a-runspace aria-label="Sharing variables, functions and modules with a Runspace">Sharing variables, functions and modules with a Runspace</a></li><li><a href=#runspace-output-using-a-thread-safe-collection aria-label="Runspace output using a thread-safe collection">Runspace output using a thread-safe collection</a></li><li><a href=#how-to-update-the-wpf-user-interface-from-another-runspace aria-label="How to update the WPF user interface from another Runspace">How to update the WPF user interface from another Runspace</a></li><li><a href=#writing-to-the-same-log-file-from-separate-runspaces aria-label="Writing to the same log file from separate Runspaces">Writing to the same log file from separate Runspaces</a></li><li><a href=#managing-runspace-lifecycle aria-label="Managing Runspace lifecycle">Managing Runspace lifecycle</a></li><li><a href=#capturing-verbose-warning-and-error-streams-from-a-runspace aria-label="Capturing Verbose, Warning and Error streams from a Runspace">Capturing Verbose, Warning and Error streams from a Runspace</a></li><li><a href=#displaying-verbose-warning-and-error-streams-in-the-console aria-label="Displaying Verbose, Warning and Error Streams in the console">Displaying Verbose, Warning and Error Streams in the console</a></li></ul></li></ul></div></details></div><div class=post-content><p><strong>Things I learned creating a GUI tool with PowerShell and WPF.</strong><br>The snippets in this article are based on the <a href=https://github.com/gbdixg/Show-Win32AppUI>Show-Win32AppUI tool</a> available on GitHub.</p><h1 id=disclaimer>Disclaimer<a hidden class=anchor aria-hidden=true href=#disclaimer>#</a></h1><p>I realise PowerShell isn&rsquo;t suited to creating GUI apps. The main reason to use PowerShell is <em>supportability</em>. Specifically, when working with Colleagues who aren&rsquo;t comfortable maintaining a compiled language like C#. Its far easier to make small changes to variables or paths in a script.</p><h1 id=why-wpf>Why WPF?<a hidden class=anchor aria-hidden=true href=#why-wpf>#</a></h1><p>WPF is a more modern and flexible choice for a UI than the something like WinForms. There are many newer frameworks available, but most require a runtime on the target platform. WPF is easy to deploy as it&rsquo;s built-into the .NET Framework and available by default on Windows 10/11.</p><h1 id=part1---design-the-app-around-powershell-runspaces>Part1 - Design the app around PowerShell Runspaces<a hidden class=anchor aria-hidden=true href=#part1---design-the-app-around-powershell-runspaces>#</a></h1><p>If you try to create a GUI app with a single thread, it will be unresponsive and hang whenever an action takes more than a few seconds. PowerShell runs under a single thread (STA mode) making it unsuitable for a responsive GUI app. However, creating separate <em>Runspaces</em> is a workaround for this problem. Runspaces are analogous to spinning up new PowerShell sessions in the background to execute discrete script blocks.</p><p>While Runspaces are effective, they also add a lot of complexity. For example:</p><ul><li>Functions and variables are not shared between Runspaces by default and have to be imported when the Runspace is started.</li><li>You should use a thread-safe collection when updating shared variables inside a Runspace.</li><li>The WPF UI can&rsquo;t be updated directly from a separate Runspace</li><li>Writing to a single file from multiple Runspaces requires a locking mechanism, such as a Mutex</li><li>The lifecycle of Runspaces must be managed, capturing output at completion</li><li>Warning, Verbose and Error streams in the Runspace are not captured by default</li><li>Warning, Verbose and Error streams do not appear in the console by default.</li></ul><p>These concepts are covered in more detail below.</p><h2 id=sharing-variables-functions-and-modules-with-a-runspace>Sharing variables, functions and modules with a Runspace<a hidden class=anchor aria-hidden=true href=#sharing-variables-functions-and-modules-with-a-runspace>#</a></h2><p><strong>Required modules</strong> must be specifically loaded into the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.management.automation.runspaces.initialsessionstate?view=powershellsdk-7.3.0">InitialSessionState</a> of the Runspace. The Runspace won&rsquo;t automatically have access to modules already loaded in the <em>parent</em> PowerShell session.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example of importing modules into a new Runspace ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$modulesToLoad</span><span class=p>=</span><span class=vm>@</span><span class=p>(</span><span class=s1>&#39;Microsoft.Graph.Intune&#39;</span><span class=p>,</span><span class=s1>&#39;MSAL.PS&#39;</span><span class=p>)</span> <span class=c># Must be installed on the computer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$initialSessionState</span> <span class=p>=</span> <span class=p>[</span><span class=no>initialsessionstate</span><span class=p>]::</span><span class=n>CreateDefault</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$module</span> <span class=k>in</span> <span class=nv>$modulesToLoad</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$initialSessionState</span><span class=p>.</span><span class=py>ImportPSModule</span><span class=p>(</span><span class=nv>$module</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span> <span class=p>=</span> <span class=p>[</span><span class=no>runspacefactory</span><span class=p>]::</span><span class=n>CreateRunspace</span><span class=p>(</span><span class=nv>$initialSessionState</span><span class=p>)</span>
</span></span></code></pre></div><p>You can also import <strong>standalone Functions</strong> into a Runspace using the <em>InitialSessionState</em>. The following imports functions already loaded in the <em>parent</em> session, but you could also load directly from a file on disk.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example importing parent session functions into a new Runspace ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$FunctionsToImport</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;Write-TxtLog&#39;</span><span class=p>,</span><span class=s1>&#39;Get-APIResults&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$function</span> <span class=k>in</span> <span class=nv>$functionsToImport</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$definition</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=s2>&#34;Function:\</span><span class=nv>$Function</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$entry</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Management</span><span class=p>.</span><span class=py>Automation</span><span class=p>.</span><span class=py>Runspaces</span><span class=p>.</span><span class=py>SessionStateFunctionEntry</span> <span class=n>-ArgumentList</span> <span class=nv>$function</span><span class=p>,</span> <span class=nv>$definition</span>
</span></span><span class=line><span class=cl>    <span class=nv>$initialSessionState</span><span class=p>.</span><span class=py>Commands</span><span class=p>.</span><span class=py>Add</span><span class=p>(</span><span class=nv>$entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span> <span class=p>=</span> <span class=p>[</span><span class=no>runspacefactory</span><span class=p>]::</span><span class=n>CreateRunspace</span><span class=p>(</span><span class=nv>$initialSessionState</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Variables</strong> can be shared with a Runspace using the <strong>SetVariable</strong> method of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.management.automation.runspaces.sessionstateproxy?view=powershellsdk-7.3.0">SessionStateProxy</a> class. SetVariable parameters are the <em>variable name</em> (without the &lsquo;$&rsquo;) and the value to set.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example importing parent session variables into a new Runspace ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$VariablesToImport</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>,</span><span class=s1>&#39;password&#39;</span><span class=p>,</span><span class=s1>&#39;displayName&#39;</span><span class=p>)</span> <span class=c># existing variables in the parent session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span> <span class=p>=</span> <span class=p>[</span><span class=no>runspacefactory</span><span class=p>]::</span><span class=n>CreateRunspace</span><span class=p>(</span><span class=nv>$initialSessionState</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span><span class=p>.</span><span class=py>Open</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>Foreach</span><span class=p>(</span><span class=nv>$var</span> <span class=k>in</span> <span class=nv>$VariablesToImport</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$VarValue</span> <span class=p>=</span> <span class=nb>Get-Variable</span> <span class=n>-Name</span> <span class=nv>$Var</span> <span class=p>|</span> <span class=nb>Select </span><span class=n>-ExpandProperty</span> <span class=n>Value</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Runspace</span><span class=p>.</span><span class=py>SessionStateProxy</span><span class=p>.</span><span class=py>SetVariable</span><span class=p>(</span><span class=nv>$Var</span><span class=p>,</span><span class=nv>$VarValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=runspace-output-using-a-thread-safe-collection>Runspace output using a thread-safe collection<a hidden class=anchor aria-hidden=true href=#runspace-output-using-a-thread-safe-collection>#</a></h2><p>Output from a Runspace can be captured during execution using a thread-safe collection imported from the parent session. When a Runspace updates the collection the updated values are available in the parent session and any concurrent Runspaces that also import the collection. Thread safe collections usually need to be <em>locked</em> during update to prevent conflicts.</p><p>With a <strong>synchronised Arraylist</strong>, values added in the Runspace will immediately available to all other Runspaces and the parent session, as in following example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example using locks on a thread safe collection ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Parent session code</span>
</span></span><span class=line><span class=cl><span class=nv>$BackgroundJobs</span> <span class=p>=</span> <span class=p>[</span><span class=no>system.collections.arraylist</span><span class=p>]::</span><span class=n>Synchronized</span><span class=p>((</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Collections</span><span class=p>.</span><span class=n>ArrayList</span><span class=p>))</span> <span class=c># Thread safe collection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span> <span class=p>=</span> <span class=p>[</span><span class=no>runspacefactory</span><span class=p>]::</span><span class=n>CreateRunspace</span><span class=p>(</span><span class=nv>$initialSessionState</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span><span class=p>.</span><span class=py>Open</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span><span class=p>.</span><span class=py>SessionStateProxy</span><span class=p>.</span><span class=py>SetVariable</span><span class=p>(</span><span class=s1>&#39;BackgroundJobs&#39;</span><span class=p>,</span><span class=nv>$BackgroundJobs</span><span class=p>)</span> <span class=c># Pass the variable into the RunSpace</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$PSCode</span> <span class=p>=</span> <span class=p>[</span><span class=no>powershell</span><span class=p>]::</span><span class=n>Create</span><span class=p>().</span><span class=py>AddScript</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=c># This is the Runspace script block</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Enter</span><span class=p>(</span><span class=nv>$BackgroundJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span> <span class=c># lock</span>
</span></span><span class=line><span class=cl>        <span class=nv>$BackgroundJobs</span><span class=p>.</span><span class=py>Add</span><span class=p>(</span><span class=s2>&#34;New item&#34;</span><span class=p>)</span> <span class=c># modify ArrayList</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>finally</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Exit</span><span class=p>(</span><span class=nv>$BackgroundJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span> <span class=c># unlock</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>},</span><span class=vm>$True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$PSCode</span><span class=p>.</span><span class=py>Runspace</span> <span class=p>=</span> <span class=nv>$Runspace</span>
</span></span><span class=line><span class=cl><span class=vm>$null</span> <span class=p>=</span> <span class=nv>$PSCode</span><span class=p>.</span><span class=py>BeginInvoke</span><span class=p>()</span>
</span></span></code></pre></div><p>There are also <em>Queues and Stacks</em> in .NET that automatically implement locking and don&rsquo;t need the System.Threading.Monitor code in the above example e.g. a <em>ConcurrentQueue</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### ConcurrentQueue example - doesn&#39;t need System.Threading.Monitor ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Parent session code</span>
</span></span><span class=line><span class=cl><span class=nv>$colQueue</span> <span class=p>=</span> <span class=p>[</span><span class=no>System.Collections.Concurrent.ConcurrentQueue[psobject]</span><span class=p>]::</span><span class=n>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nv>$colQueue</span><span class=p>.</span><span class=py>TryAdd</span><span class=p>([</span><span class=no>pscustomobject</span><span class=p>]</span><span class=vm>@</span><span class=p>{</span> <span class=n>givenName</span> <span class=p>=</span> <span class=s1>&#39;Bill&#39;</span><span class=p>;</span><span class=n>sn</span><span class=p>=</span><span class=s1>&#39;Gates&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nv>$colQueue</span><span class=p>.</span><span class=py>TryAdd</span><span class=p>([</span><span class=no>pscustomobject</span><span class=p>]</span><span class=vm>@</span><span class=p>{</span> <span class=n>givenName</span> <span class=p>=</span> <span class=s1>&#39;Steve&#39;</span><span class=p>;</span><span class=n>sn</span><span class=p>=</span><span class=s1>&#39;Jobs&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span><span class=p>.</span><span class=py>SessionStateProxy</span><span class=p>.</span><span class=py>SetVariable</span><span class=p>(</span><span class=s1>&#39;colQueue&#39;</span><span class=p>,</span><span class=nv>$colQueue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$PSCode</span> <span class=p>=</span> <span class=p>[</span><span class=no>powershell</span><span class=p>]::</span><span class=n>Create</span><span class=p>().</span><span class=py>AddScript</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=c># This is the Runspace script block</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c># No locking required when ConcurrentQueue is modified in the Runspace</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Entry</span> <span class=p>=</span> <span class=vm>$null</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$colQueue</span><span class=p>.</span><span class=py>TryDequeue</span><span class=p>([</span><span class=no>ref</span><span class=p>]</span><span class=nv>$Entry</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Output</span> <span class=nv>$Entry</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl> <span class=p>},</span><span class=vm>$True</span><span class=p>)</span>   
</span></span></code></pre></div><p>More information on thread safe collections is available <a href=https://learn.microsoft.com/en-us/dotnet/standard/collections/thread-safe/>here</a></p><h2 id=how-to-update-the-wpf-user-interface-from-another-runspace>How to update the WPF user interface from another Runspace<a hidden class=anchor aria-hidden=true href=#how-to-update-the-wpf-user-interface-from-another-runspace>#</a></h2><p>If you try to modify the WPF user interface from a separate Runspace, PowerShell will throw an error indicating only the owning thread (Runspace) can update it.</p><p><img loading=lazy src=/img/UIThreadError2.png alt=UIError></p><p>The solution is to wrap the update in a <strong>Dispatcher.Invoke</strong> method as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example updating a WPF control from another thread (Runspace) ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># In the Runspace script block</span>
</span></span><span class=line><span class=cl><span class=c># txt_SetupFile is a WPF text box created in the parent session of the Runspace</span>
</span></span><span class=line><span class=cl><span class=nv>$UIControls</span><span class=p>.</span><span class=py>txt_SetupFile</span><span class=p>.</span><span class=py>Dispatcher</span><span class=p>.</span><span class=py>Invoke</span><span class=p>([</span><span class=no>action</span><span class=p>]{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$UIControls</span><span class=p>.</span><span class=py>txt_SetupFile</span><span class=p>.</span><span class=py>Text</span> <span class=p>=</span> <span class=s2>&#34;Successfully updated from another Runspace&#34;</span>
</span></span><span class=line><span class=cl><span class=p>},</span><span class=s2>&#34;Normal&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=writing-to-the-same-log-file-from-separate-runspaces>Writing to the same log file from separate Runspaces<a hidden class=anchor aria-hidden=true href=#writing-to-the-same-log-file-from-separate-runspaces>#</a></h2><p>Runspaces also make it more complex to write to a single log file. There is potential for a deadlock or <a href=https://learn.microsoft.com/en-us/dotnet/standard/threading/managed-threading-best-practices#race-conditions>race condition</a> to occur. A <strong>Mutex</strong> is one way to implement the required locking:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example using a Mutex lock before writing to a log file ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># In the Runspace script block</span>
</span></span><span class=line><span class=cl><span class=c># LogMutex is an arbitrary name but must be the same when used in any Runspace and the parent session</span>
</span></span><span class=line><span class=cl><span class=nv>$mtx</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Threading</span><span class=p>.</span><span class=py>Mutex</span><span class=p>(</span><span class=vm>$false</span><span class=p>,</span> <span class=s2>&#34;LogMutex&#34;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>If</span> <span class=p>(</span><span class=nv>$mtx</span><span class=p>.</span><span class=py>WaitOne</span><span class=p>()){</span> <span class=c># Wait until this Runspace can get a lock on the LogMutex object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c># Lock obtained. Other Runspaces are now waiting</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Add-Content</span> <span class=n>-Path</span> <span class=nv>$logFile</span> <span class=n>-Value</span> <span class=nv>$Message</span>  <span class=n>-ErrorAction</span> <span class=n>Stop</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>finally</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>void</span><span class=p>]</span><span class=nv>$mtx</span><span class=p>.</span><span class=py>ReleaseMutex</span><span class=p>()</span> <span class=c># release the lock</span>
</span></span><span class=line><span class=cl>        <span class=nv>$mtx</span><span class=p>.</span><span class=py>Dispose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=managing-runspace-lifecycle>Managing Runspace lifecycle<a hidden class=anchor aria-hidden=true href=#managing-runspace-lifecycle>#</a></h2><p>A Runspace executes its script block asynchronously and output (if any) is available at the end. The parent session must manage Runspaces, checking for completion, processing output and ultimately disposing of them. If you don&rsquo;t dispose of Runspaces they will persist until the parent PowerShell session is closed and could eat-up memory.</p><p>A <strong>Timer</strong> is a common way to manage Runspaces in an event-driven WPF script. When the Timer event fires, its script blocks checks for Runspace completion as in the example below. A thread safe collection is used to keep track of Runspaces until they are disposed of.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example Timer code to clean-up completed Runspaces ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create a collection to track Runspaces</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$PS</span> <span class=p>=</span> <span class=p>[</span><span class=no>powershell</span><span class=p>]::</span><span class=n>Create</span><span class=p>().</span><span class=py>AddScript</span><span class=p>(</span><span class=nv>$codeToRunInRunspace</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$handle</span> <span class=p>=</span> <span class=nv>$PS</span><span class=p>.</span><span class=py>BeginInvoke</span><span class=p>()</span> <span class=c># Start the runspace</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Add the new Runspace to the RunspaceJobs collection</span>
</span></span><span class=line><span class=cl><span class=nv>$RunspaceJobs</span> <span class=p>=</span> <span class=p>[</span><span class=no>system.collections.arraylist</span><span class=p>]::</span><span class=n>Synchronized</span><span class=p>((</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Collections</span><span class=p>.</span><span class=n>ArrayList</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Enter</span><span class=p>(</span><span class=nv>$RunspaceJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span> <span class=c># lock</span>
</span></span><span class=line><span class=cl>    <span class=nv>$RunspaceJobs</span><span class=p>.</span><span class=py>Add</span><span class=p>([</span><span class=no>PSCustomObject</span><span class=p>]</span><span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>powerShell</span> <span class=p>=</span> <span class=nv>$PS</span>  <span class=c># System.Management.Automation.PowerShell object</span>
</span></span><span class=line><span class=cl>        <span class=n>runspace</span> <span class=p>=</span> <span class=nv>$handle</span> <span class=c># System.Management.Automation.PowerShellAsyncResult Object</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>finally</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Exit</span><span class=p>(</span><span class=nv>$RunspaceJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span> <span class=c># unlock</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Timer to manage Runspace lifecycle</span>
</span></span><span class=line><span class=cl><span class=nv>$RunspaceCleanupTimer</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Windows</span><span class=p>.</span><span class=py>Forms</span><span class=p>.</span><span class=py>Timer</span>
</span></span><span class=line><span class=cl><span class=nv>$RunspaceCleanupTimer</span><span class=p>.</span><span class=py>Enabled</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl><span class=nv>$RunspaceCleanupTimer</span><span class=p>.</span><span class=py>Interval</span> <span class=p>=</span> <span class=mf>5000</span>  <span class=c># Timer code runs every 5 seconds</span>
</span></span><span class=line><span class=cl><span class=nv>$RunspaceCleanupTimer</span><span class=p>.</span><span class=py>Add_Tick</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=c># In the timer code</span>
</span></span><span class=line><span class=cl>    <span class=k>Foreach</span><span class=p>(</span><span class=nv>$job</span> <span class=k>in</span> <span class=nv>$Script:RunspaceJobs</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$job</span><span class=p>.</span><span class=py>runspace</span><span class=p>.</span><span class=py>IsCompleted</span> <span class=o>-eq</span> <span class=vm>$True</span><span class=p>){</span>
</span></span><span class=line><span class=cl>           
</span></span><span class=line><span class=cl>           <span class=c># Capture completed Runspace output and dispose of it to free-up memory</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$RSOutput</span> <span class=p>=</span> <span class=nv>$job</span><span class=p>.</span><span class=py>powerShell</span><span class=p>.</span><span class=py>EndInvoke</span><span class=p>(</span><span class=nv>$job</span><span class=p>.</span><span class=n>runspace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nv>$job</span><span class=p>.</span><span class=py>powerShell</span><span class=p>.</span><span class=py>runspace</span><span class=p>.</span><span class=py>Dispose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c># Remove the job from the tracking collection</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Enter</span><span class=p>(</span><span class=nv>$Script:RunspaceJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$Script:RunspaceJobs</span><span class=p>.</span><span class=py>Remove</span><span class=p>(</span><span class=nv>$job</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span><span class=k>finally</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Exit</span><span class=p>(</span><span class=nv>$Script:RunspaceJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>}</span><span class=k>catch</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nb>Write-Host</span> <span class=s2>&#34;Runspace disposal Failed &#39;</span><span class=nv>$_</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=c>#foreach</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>})</span><span class=c>#End of timer scriptblock</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$RunspaceCleanupTimer</span><span class=p>.</span><span class=py>Start</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=capturing-verbose-warning-and-error-streams-from-a-runspace>Capturing Verbose, Warning and Error streams from a Runspace<a hidden class=anchor aria-hidden=true href=#capturing-verbose-warning-and-error-streams-from-a-runspace>#</a></h2><p>By default, the Runspace output streams are not displayed in the parent session console and are lost when the Runspace is disposed.<br>The output can be captured at Runspace completion using the <strong>Streams</strong> object. The modification below to the Timer script block saves the output to a log file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>#### Modified Timer code to capture additional output streams at clean-up ####</span>
</span></span><span class=line><span class=cl><span class=k>Foreach</span><span class=p>(</span><span class=nv>$job</span> <span class=k>in</span> <span class=nv>$Global:BackgroundJobs</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$job</span><span class=p>.</span><span class=py>runspace</span><span class=p>.</span><span class=py>IsCompleted</span> <span class=o>-eq</span> <span class=vm>$True</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-TxtLog</span> <span class=s2>&#34;Runspace &#39;</span><span class=p>$(</span><span class=nv>$job</span><span class=p>.</span><span class=py>powershell</span><span class=p>.</span><span class=py>runspace</span><span class=p>.</span><span class=n>name</span><span class=p>)</span><span class=s2>&#39; completed...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Could also include &#39;DEBUG&#39; and &#39;Information&#39; streams if used in your Runspaces</span>
</span></span><span class=line><span class=cl>        <span class=nv>$Streams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Verbose&#39;</span><span class=p>=</span><span class=s1>&#39;VERBOSE&#39;</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Warning&#39;</span><span class=p>=</span><span class=s1>&#39;WARN&#39;</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Error&#39;</span><span class=p>=</span><span class=s1>&#39;ERROR&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>Foreach</span><span class=p>(</span><span class=nv>$StreamType</span> <span class=k>in</span> <span class=nv>$Streams</span><span class=p>.</span><span class=n>Keys</span><span class=p>){</span>                        
</span></span><span class=line><span class=cl>            <span class=nv>$StreamOutput</span> <span class=p>=</span> <span class=nv>$job</span><span class=p>.</span><span class=py>powershell</span><span class=p>.</span><span class=py>Streams</span><span class=p>.</span><span class=s2>&#34;</span><span class=nv>$StreamType</span><span class=s2>&#34;</span>  <span class=c># Capture the Runspace output for each stream</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=nv>$StreamOutput</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nv>$StreamOutput</span> <span class=p>|</span> <span class=nb>Foreach-Object</span> <span class=p>{</span> <span class=nb>Write-TxtLog</span> <span class=nv>$_</span> <span class=n>-indent</span> <span class=mf>2</span> <span class=n>-severity</span> <span class=vm>$</span><span class=p>(</span><span class=nv>$Streams</span><span class=p>[</span><span class=nv>$StreamType</span><span class=p>])</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nb>Remove-Variable</span> <span class=n>-name</span> <span class=s1>&#39;StreamOutput&#39;</span> <span class=n>-force</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-TxtLog</span> <span class=s2>&#34;Disposing of runspace...&#34;</span> <span class=n>-indent</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$RSOutput</span> <span class=p>=</span> <span class=nv>$job</span><span class=p>.</span><span class=py>powerShell</span><span class=p>.</span><span class=py>EndInvoke</span><span class=p>(</span><span class=nv>$job</span><span class=p>.</span><span class=n>runspace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>$job</span><span class=p>.</span><span class=py>powerShell</span><span class=p>.</span><span class=py>runspace</span><span class=p>.</span><span class=py>Dispose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c># Remove the job from the tracking list</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Enter</span><span class=p>(</span><span class=nv>$Global:BackgroundJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nv>$Global:BackgroundJobs</span><span class=p>.</span><span class=py>Remove</span><span class=p>(</span><span class=nv>$job</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span><span class=k>finally</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=no>System.Threading.Monitor</span><span class=p>]::</span><span class=n>Exit</span><span class=p>(</span><span class=nv>$Global:BackgroundJobs</span><span class=p>.</span><span class=n>SyncRoot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>catch</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nb>Write-TxtLog</span> <span class=s2>&#34;Failed &#39;</span><span class=nv>$_</span><span class=s2>&#39;&#34;</span> <span class=n>-indent</span> <span class=mf>2</span> <span class=n>-severity</span> <span class=n>ERROR</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=c>#foreach</span>
</span></span></code></pre></div><h2 id=displaying-verbose-warning-and-error-streams-in-the-console>Displaying Verbose, Warning and Error Streams in the console<a hidden class=anchor aria-hidden=true href=#displaying-verbose-warning-and-error-streams-in-the-console>#</a></h2><p>The approach above captures output when the Runspace code has completed. If you want feedback in the console during execution there are a couple of methods.</p><p>Firstly, the simplest option is to use the <strong>.NET Console.Writeline()</strong> method. Although this doesn&rsquo;t capture the PowerShell streams, it is a simple way to provide real-time console output in the parent session.<br>You will need to implement your own colour-coding to distinguish between warnings or errors if needed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example Runspace code to write to parent PowerShell console ###</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>console</span><span class=p>]::</span><span class=n>ForegroundColor</span><span class=p>=</span><span class=s1>&#39;YELLOW&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>Console</span><span class=p>]::</span><span class=n>WriteLine</span><span class=p>(</span><span class=s1>&#39;Username was not found&#39;</span><span class=p>)</span>  <span class=c># Automatically writes to the parent session</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=no>console</span><span class=p>]::</span><span class=n>ResetColor</span><span class=p>()</span>
</span></span></code></pre></div><p>Alternatively, you could pass the built-in $Host variable from the parent session into the Runspace and use methods like WriteVerboseLine() as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c>### Example writing to parent console using the $Host variable </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Parent session code</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span> <span class=p>=</span> <span class=p>[</span><span class=no>runspacefactory</span><span class=p>]::</span><span class=n>CreateRunspace</span><span class=p>(</span><span class=nv>$initialSessionState</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span><span class=p>.</span><span class=py>Open</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nv>$Runspace</span><span class=p>.</span><span class=py>SessionStateProxy</span><span class=p>.</span><span class=py>SetVariable</span><span class=p>(</span><span class=s1>&#39;ParentHost&#39;</span><span class=p>,</span><span class=nv>$Host</span><span class=p>)</span>  <span class=c># Built-in host variable passed into the Runspace as $ParentHost</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Write to the parent console from the Runspace script block</span>
</span></span><span class=line><span class=cl><span class=nv>$ParentHost</span><span class=p>.</span><span class=py>ui</span><span class=p>.</span><span class=py>WriteVerboseLine</span><span class=p>(</span><span class=s2>&#34;Realtime verbose output from Runspace in parent console&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$ParentHost</span><span class=p>.</span><span class=py>UI</span><span class=p>.</span><span class=py>WriteWarningLine</span><span class=p>(</span><span class=s2>&#34;Realtime warning output from Runspace in parent console&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$ParentHost</span><span class=p>.</span><span class=py>UI</span><span class=p>.</span><span class=py>WriteErrorLine</span><span class=p>(</span><span class=s2>&#34;Realtime error output from Runspace in parent console&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>See the <a href=https://github.com/gbdixg/Show-Win32AppUI>Show-Win32AppUI tool</a> for an example of using these ideas together in a WPF app.</p><p>See <a href=/2023/03/21/PowerShellWPFPt2/>part2 of this series</a> for information on WPF controls, events and XAML.</p><p><br><br></p><blockquote><p>This article was originally posted on <a href=http://write-verbose.com>Write-Verbose.com</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://write-verbose.com/tags/powershell/>PowerShell</a></li><li><a href=https://write-verbose.com/tags/wpf/>WPF</a></li></ul><nav class=paginav><a class=prev href=https://write-verbose.com/2023/03/21/PowerShellWPFPt2/><span class=title>« Prev</span><br><span>Creating a GUI App with PowerShell and WPF - Part 2 Controls, Events and XAML</span></a>
<a class=next href=https://write-verbose.com/2023/03/19/AzureAppRegistration/><span class=title>Next »</span><br><span>Avoid excess permissions with a custom app to access MSGraph PowerShell</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Creating a GUI App with PowerShell and WPF - Part 1 Runspaces on twitter" href="https://twitter.com/intent/tweet/?text=Creating%20a%20GUI%20App%20with%20PowerShell%20and%20WPF%20-%20Part%201%20Runspaces&url=https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f&hashtags=PowerShell%2cWPF"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Creating a GUI App with PowerShell and WPF - Part 1 Runspaces on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f&title=Creating%20a%20GUI%20App%20with%20PowerShell%20and%20WPF%20-%20Part%201%20Runspaces&summary=Creating%20a%20GUI%20App%20with%20PowerShell%20and%20WPF%20-%20Part%201%20Runspaces&source=https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Creating a GUI App with PowerShell and WPF - Part 1 Runspaces on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f&title=Creating%20a%20GUI%20App%20with%20PowerShell%20and%20WPF%20-%20Part%201%20Runspaces"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Creating a GUI App with PowerShell and WPF - Part 1 Runspaces on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Creating a GUI App with PowerShell and WPF - Part 1 Runspaces on whatsapp" href="https://api.whatsapp.com/send?text=Creating%20a%20GUI%20App%20with%20PowerShell%20and%20WPF%20-%20Part%201%20Runspaces%20-%20https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Creating a GUI App with PowerShell and WPF - Part 1 Runspaces on telegram" href="https://telegram.me/share/url?text=Creating%20a%20GUI%20App%20with%20PowerShell%20and%20WPF%20-%20Part%201%20Runspaces&url=https%3a%2f%2fwrite-verbose.com%2f2023%2f03%2f21%2fPowerShellWPFPt1%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://write-verbose.com/>Write-Verbose</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>