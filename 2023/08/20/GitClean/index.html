<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters | Write-Verbose</title><meta name=keywords content="Git,Defender,GitHub"><meta name=description content="Git Filters can replace code at staging to avoid committing unwanted information, such as the Azure AppID or TenantID."><meta name=author content="GD"><link rel=canonical href=https://write-verbose.com/2023/08/20/GitClean/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://write-verbose.com/fav/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://write-verbose.com/fav/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://write-verbose.com/fav/favicon-32x32.png><link rel=apple-touch-icon href=https://write-verbose.com/apple-touch-icon.png><link rel=mask-icon href=https://write-verbose.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/hybrid.min.css integrity="sha512-BoPJq6KvI1u+cpSqlC0hoQBjJNPcq1xpOncS9hMdGLMBoLJO7qGIZbK5YOk0DkIvn4EmKyZRpcwjLm4GygUX+g==" crossorigin=anonymous><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-141237050-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters"><meta property="og:description" content="Git Filters can replace code at staging to avoid committing unwanted information, such as the Azure AppID or TenantID."><meta property="og:type" content="article"><meta property="og:url" content="https://write-verbose.com/2023/08/20/GitClean/"><meta property="og:image" content="https://write-verbose.com/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-20T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://write-verbose.com/papermod-cover.png"><meta name=twitter:title content="Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters"><meta name=twitter:description content="Git Filters can replace code at staging to avoid committing unwanted information, such as the Azure AppID or TenantID."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://write-verbose.com/posts/"},{"@type":"ListItem","position":2,"name":"Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters","item":"https://write-verbose.com/2023/08/20/GitClean/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters","name":"Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters","description":"Git Filters can replace code at staging to avoid committing unwanted information, such as the Azure AppID or TenantID.","keywords":["Git","Defender","GitHub"],"articleBody":"The git filter option isn’t well documented, but its very useful for removing sensitive information you don’t want appearing in your public repo. This post provides an example of replacing the Azure TenantID and AppID with dummy values during the git commit process for a PowerShell script.\nBackground Best practice is to never hard code sensitive information in your scripts. Better strategies include:\nAccessing an encrypted vault at runtime (Azure KeyVault, CyberArk Privileged Access etc) Operator supplied information at runtime (for interactive scripts) Having said that, there is information that isn’t “secret” but is specific to an environment that needs to be removed before making code public.\nScenario I’ll use the PSMDE PowerShell module as an example.\nThis PowerShell module is used interactively to manage Defender for Endpoint from the command line. The code uses the delegated authentication of an Azure Enterprise Application to access the Defender Security API. It uses Authorization Code Flow with the following environment-specific information:\nValue Format Comment TenantID GUID string Specific to an Azure environment ClientID GUID string A.K.A ApplicationID. Specific to an Azure Enterprise App. Credentials Multiple options Username / Password supplied interactively in this case The Connect-SecurityCenter.ps1 script makes authentication simple by including default values for the TenantID and ClientID. The administrator just calls the script and is prompted for credentials with sufficient access.\nConnect-SecurityCenter.ps1 extract with default values for TenantID and ClientID (AppID):\nFunction Connect-SecurityCenter{ [CmdletBinding()] Param( [parameter()] [ValidateNotNullOrEmpty()] [String]$TenantID = 'f8856e0c-f363-4583-9a2f-ef0208473d3c' , [parameter()] [ValidateNotNullOrEmpty()] [String]$ClientID = '7c0cc95f-d722-4533-94e2-92530f29c07c' ) ... Someone downloading the public code is expected to edit the default values for their own environment.\nSo how do we develop this module with our own variable defaults, but avoid committing them to the public repo?\nGit Filter Git can apply filter scripts to the code during the staging step to replace text. The working directory retains the default values, but the repo code has sanitised replacement text.\nA Clean filter script is applied when the code is staged to the git index. A Smudge filter script is applied at checkout - effectively the opposite direction. The steps below explain how to implement these filters.\nStep 1: Enable filtering in the git global config Update the git config to enable the filters as follows. This can be done in the per-repo git config, but I find its better as a global option…\nCommand format:\ngit config –global filter..\n# Commands to run git config --global filter.gitClean.clean \"~/gitclean.sh\" git config --global filter.gitClean.smudge \"~/gitsmudge.sh\" gitClean is the freeform name for the filter. You can create multiple filters with separate scripts. gitClean has a separate clean script (gitclean.sh) and smudge script (gitsmudge.sh) Both scripts are in the user’s home folder (~/ is c:\\users\\username on Windows) Step 2: Create the clean and smudge scripts Even on Windows git uses bash to execute scripts. You might be able to get PowerShell working, but I found it easier just to stick with bash. The built-in sed command can be used to replace text as follows:\nCommand format:\nsed -e “s///”\nThe text specified by is replaced by the text in . The “g” flag replaces all occurrences in the file.\nThe gitclean.sh script replaces the real tenant ID and application ID with dummy text and the gitsmudge.sh script reverses the replacement.\n#!/usr/bin/env bash # gitclean.sh TenantID=\"f8856e0c-f363-4583-9a2f-ef0208473d3c\" AppID=\"7c0cc95f-d722-4533-94e2-92530f29c07c\" sed -e \"s/$TenantID/00000000-0000-0000-0000-TENANTID/g\" -e \"s/$AppID/00000000-0000-0000-0000-APPID/g\" #!/usr/bin/env bash # gitsmudge.sh TenantID=\"f8856e0c-f363-4583-9a2f-ef0208473d3c\" AppID=\"7c0cc95f-d722-4533-94e2-92530f29c07c\" sed -e \"s/00000000-0000-0000-0000-TENANTID/$TenantID/g\" -e \"s/00000000-0000-0000-0000-APPID/$AppID/g\" On Windows the files should be saved in the c:\\users\\ folder.\nWatch out for unix line ending and encoding requirements - In Visual Studio Code:\nIf the status bar shows CRLF, double-click on it and change to LF If the status bar shows UTF-8 with BOM, double-click on it and change to UTF-8 Step 3: Specify the file extensions that use the filter Edit the git attributes file in the repo:\n.git\\info\\attributes\nIf the file doesn’t exist, create it as a new text file with no file extension.\nAdd a line with filter= as follows:\n*.ps1 filter=gitClean Step 4: Stage the files in the index The filter is applied at staging, but it won’t be immediately obvious that anything has happened. Add or update the file using git add:\ngit add public\\Connect-SecurityCenter.ps1 The command will complete as normal. The file in the working directory will still have the real TenantID and AppID, but the staged file will have the replacement dummy values. Commit the staged file to the local repo and push to update to the public remote repo.\ngit commit -m \"Update to Connect-SecurityCenter.ps1\" git push origin Check the GitHub repo to confirm the text replacement was successful.\nOn subsequent updates, git diff will confirm the text replacement is successful at staging, before commit. It won’t show any differences for these lines - indicating the dummy values are in-place.\ngit diff --staged Now that git filtering is in-place, you can edit and update the code without worrying that unwanted information is in the public domain.\nThis article was originally posted on Write-Verbose.com\n","wordCount":"839","inLanguage":"en","datePublished":"2023-08-20T00:00:00Z","dateModified":"2023-08-20T00:00:00Z","author":{"@type":"Person","name":"GD"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://write-verbose.com/2023/08/20/GitClean/"},"publisher":{"@type":"Organization","name":"Write-Verbose","logo":{"@type":"ImageObject","url":"https://write-verbose.com/fav/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://write-verbose.com/ accesskey=h title="Write-Verbose (Alt + H)">Write-Verbose</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://write-verbose.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://write-verbose.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://write-verbose.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://write-verbose.com/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://write-verbose.com/>Home</a>&nbsp;»&nbsp;<a href=https://write-verbose.com/posts/>Posts</a></div><h1 class=post-title>Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters</h1><div class=post-description>Git Filters can replace code at staging to avoid committing unwanted information, such as the Azure AppID or TenantID.</div><div class=post-meta><span title='2023-08-20 00:00:00 +0000 UTC'>August 20, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;GD</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#scenario aria-label=Scenario>Scenario</a></li><li><a href=#git-filter aria-label="Git Filter">Git Filter</a></li><li><a href=#step-1-enable-filtering-in-the-git-global-config aria-label="Step 1: Enable filtering in the git global config">Step 1: Enable filtering in the git global config</a></li><li><a href=#step-2-create-the-clean-and-smudge-scripts aria-label="Step 2: Create the clean and smudge scripts">Step 2: Create the clean and smudge scripts</a></li><li><a href=#step-3-specify-the-file-extensions-that-use-the-filter aria-label="Step 3: Specify the file extensions that use the filter">Step 3: Specify the file extensions that use the filter</a></li><li><a href=#step-4-stage-the-files-in-the-index aria-label="Step 4: Stage the files in the index">Step 4: Stage the files in the index</a></li></ul></div></details></div><div class=post-content><p>The git filter option isn&rsquo;t well documented, but its <strong>very useful for removing sensitive information you don&rsquo;t want appearing in your public repo</strong>. This post provides an example of replacing the Azure TenantID and AppID with dummy values during the git commit process for a PowerShell script.</p><h2 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h2><p>Best practice is to never hard code sensitive information in your scripts. Better strategies include:</p><ul><li>Accessing an encrypted vault at runtime (Azure KeyVault, CyberArk Privileged Access etc)</li><li>Operator supplied information at runtime (for interactive scripts)</li></ul><blockquote><p>Having said that, there is information that isn&rsquo;t &ldquo;secret&rdquo; but is specific to an environment that needs to be removed before making code public.</p></blockquote><h2 id=scenario>Scenario<a hidden class=anchor aria-hidden=true href=#scenario>#</a></h2><p>I&rsquo;ll use the <a href=https://github.com/gbdixg/PSMDE target=_blank>PSMDE PowerShell module</a> as an example.<br>This PowerShell module is used interactively to manage Defender for Endpoint from the command line.
The code uses the delegated authentication of an Azure Enterprise Application to access the Defender Security API. It uses <a href=https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow target=_blank>Authorization Code Flow</a> with the following environment-specific information:</p><table><thead><tr><th>Value</th><th>Format</th><th>Comment</th></tr></thead><tbody><tr><td>TenantID</td><td>GUID string</td><td>Specific to an Azure environment</td></tr><tr><td>ClientID</td><td>GUID string</td><td>A.K.A ApplicationID. Specific to an Azure Enterprise App.</td></tr><tr><td>Credentials</td><td>Multiple options</td><td>Username / Password supplied interactively in this case</td></tr></tbody></table><p>The <a href=https://github.com/gbdixg/PSMDE/blob/master/Public/Connect-SecurityCenter.ps1 target=_blank>Connect-SecurityCenter.ps1</a> script <strong>makes authentication simple by including default values for the TenantID and ClientID</strong>. The administrator just calls the script and is prompted for credentials with sufficient access.</p><p><em>Connect-SecurityCenter.ps1</em> extract with default values for TenantID and ClientID (AppID):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=kd>Function</span><span class=w> </span><span class=nb>Connect-SecurityCenter</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=p>[</span><span class=nb>CmdletBinding</span><span class=p>()]</span>
</span></span><span class=line><span class=cl> <span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>parameter</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateNotNullOrEmpty</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>String</span><span class=p>]</span><span class=nv>$TenantID</span> <span class=p>=</span> <span class=s1>&#39;f8856e0c-f363-4583-9a2f-ef0208473d3c&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>parameter</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateNotNullOrEmpty</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>String</span><span class=p>]</span><span class=nv>$ClientID</span> <span class=p>=</span> <span class=s1>&#39;7c0cc95f-d722-4533-94e2-92530f29c07c&#39;</span>
</span></span><span class=line><span class=cl> <span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=p>...</span>
</span></span></code></pre></div><p>Someone downloading the public code is expected to edit the default values for their own environment.</p><blockquote><p>So how do we develop this module with our own variable defaults, but avoid committing them to the public repo?</p></blockquote><h2 id=git-filter>Git Filter<a hidden class=anchor aria-hidden=true href=#git-filter>#</a></h2><p>Git can apply filter scripts to the code during the staging step to replace text. The working directory retains the default values, but the repo code has sanitised replacement text.</p><p>A <strong>Clean</strong> filter script is applied when the code is staged to the git index. A <strong>Smudge</strong> filter script is applied at checkout - effectively the opposite direction. The steps below explain how to implement these filters.</p><h2 id=step-1-enable-filtering-in-the-git-global-config>Step 1: Enable filtering in the git global config<a hidden class=anchor aria-hidden=true href=#step-1-enable-filtering-in-the-git-global-config>#</a></h2><p>Update the git config to enable the filters as follows. This can be done in the per-repo git config, but I find its better as a global option&mldr;</p><p>Command format:<br>git config &ndash;global filter.&lt;filter name>.&lt;clean|smudge>&lt;path to a script | inline command></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Commands to run</span>
</span></span><span class=line><span class=cl>git config --global filter.gitClean.clean <span class=s2>&#34;~/gitclean.sh&#34;</span>
</span></span><span class=line><span class=cl>git config --global filter.gitClean.smudge <span class=s2>&#34;~/gitsmudge.sh&#34;</span>
</span></span></code></pre></div><ul><li><em>gitClean</em> is the freeform name for the filter. You can create multiple filters with separate scripts.</li><li>gitClean has a separate clean script (gitclean.sh) and smudge script (gitsmudge.sh)</li><li>Both scripts are in the user&rsquo;s home folder (~/ is c:\users\username on Windows)</li></ul><h2 id=step-2-create-the-clean-and-smudge-scripts>Step 2: Create the clean and smudge scripts<a hidden class=anchor aria-hidden=true href=#step-2-create-the-clean-and-smudge-scripts>#</a></h2><p>Even on Windows git uses bash to execute scripts. You might be able to get PowerShell working, but I found it easier just to stick with bash. The built-in <em>sed</em> command can be used to replace text as follows:</p><p>Command format:<br>sed -e &ldquo;s/&lt;pattern>/&lt;replacement>/&lt;flags>&rdquo;</p><p>The text specified by &lt;pattern> is replaced by the text in &lt;replacement>. The &ldquo;g&rdquo; flag replaces all occurrences in the file.</p><p>The <strong>gitclean.sh</strong> script replaces the real tenant ID and application ID with dummy text and the <strong>gitsmudge.sh</strong> script reverses the replacement.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># gitclean.sh</span>
</span></span><span class=line><span class=cl><span class=nv>TenantID</span><span class=o>=</span><span class=s2>&#34;f8856e0c-f363-4583-9a2f-ef0208473d3c&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>AppID</span><span class=o>=</span><span class=s2>&#34;7c0cc95f-d722-4533-94e2-92530f29c07c&#34;</span>
</span></span><span class=line><span class=cl>sed -e <span class=s2>&#34;s/</span><span class=nv>$TenantID</span><span class=s2>/00000000-0000-0000-0000-TENANTID/g&#34;</span> -e <span class=s2>&#34;s/</span><span class=nv>$AppID</span><span class=s2>/00000000-0000-0000-0000-APPID/g&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># gitsmudge.sh</span>
</span></span><span class=line><span class=cl><span class=nv>TenantID</span><span class=o>=</span><span class=s2>&#34;f8856e0c-f363-4583-9a2f-ef0208473d3c&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>AppID</span><span class=o>=</span><span class=s2>&#34;7c0cc95f-d722-4533-94e2-92530f29c07c&#34;</span>
</span></span><span class=line><span class=cl>sed -e <span class=s2>&#34;s/00000000-0000-0000-0000-TENANTID/</span><span class=nv>$TenantID</span><span class=s2>/g&#34;</span> -e <span class=s2>&#34;s/00000000-0000-0000-0000-APPID/</span><span class=nv>$AppID</span><span class=s2>/g&#34;</span>
</span></span></code></pre></div><p>On Windows the files should be saved in the c:\users\&lt;username> folder.</p><p><strong>Watch out for unix line ending and encoding requirements</strong> - In Visual Studio Code:</p><ul><li>If the status bar shows CRLF, double-click on it and change to LF</li><li>If the status bar shows <em>UTF-8 with BOM</em>, double-click on it and change to <em>UTF-8</em></li></ul><h2 id=step-3-specify-the-file-extensions-that-use-the-filter>Step 3: Specify the file extensions that use the filter<a hidden class=anchor aria-hidden=true href=#step-3-specify-the-file-extensions-that-use-the-filter>#</a></h2><p>Edit the git <em>attributes</em> file in the repo:</p><blockquote><p>.git\info\attributes</p></blockquote><p>If the file doesn&rsquo;t exist, create it as a new text file with no file extension.<br>Add a line with &lt;file extension> filter=&lt;filter name> as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*.ps1 <span class=nv>filter</span><span class=o>=</span>gitClean
</span></span></code></pre></div><h2 id=step-4-stage-the-files-in-the-index>Step 4: Stage the files in the index<a hidden class=anchor aria-hidden=true href=#step-4-stage-the-files-in-the-index>#</a></h2><p>The filter is applied at staging, but it won&rsquo;t be immediately obvious that anything has happened. Add or update the file using <strong>git add</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add public<span class=se>\C</span>onnect-SecurityCenter.ps1
</span></span></code></pre></div><p>The command will complete as normal. The file in the working directory will still have the real TenantID and AppID, but the staged file will have the replacement dummy values. Commit the staged file to the local repo and push to update to the public remote repo.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git commit -m <span class=s2>&#34;Update to Connect-SecurityCenter.ps1&#34;</span>
</span></span><span class=line><span class=cl>git push origin
</span></span></code></pre></div><p>Check the GitHub repo to confirm the text replacement was successful.</p><p>On subsequent updates, <em>git diff</em> will confirm the text replacement is successful at staging, before commit. It won&rsquo;t show any differences for these lines - indicating the dummy values are in-place.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git diff --staged
</span></span></code></pre></div><p>Now that git filtering is in-place, you can edit and update the code without worrying that unwanted information is in the public domain.</p><p><br><br></p><blockquote><p>This article was originally posted on <a href=http://write-verbose.com target=_blank>Write-Verbose.com</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://write-verbose.com/tags/git/>Git</a></li><li><a href=https://write-verbose.com/tags/defender/>Defender</a></li><li><a href=https://write-verbose.com/tags/github/>GitHub</a></li></ul><nav class=paginav><a class=prev href=https://write-verbose.com/2023/08/27/PSMDE/><span class=title>« Prev</span><br><span>PSMDE - PowerShell Defender for Endpoint Module</span></a>
<a class=next href=https://write-verbose.com/2023/08/13/HyperVDiff/><span class=title>Next »</span><br><span>Create a Hyper-V VM with a differencing disk using PowerShell</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters on twitter" href="https://twitter.com/intent/tweet/?text=Replace%20sensitive%20information%20before%20committing%20PowerShell%20scripts%20using%20Git%20Clean%20and%20Smudge%20Filters&url=https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f&hashtags=Git%2cDefender%2cGitHub"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f&title=Replace%20sensitive%20information%20before%20committing%20PowerShell%20scripts%20using%20Git%20Clean%20and%20Smudge%20Filters&summary=Replace%20sensitive%20information%20before%20committing%20PowerShell%20scripts%20using%20Git%20Clean%20and%20Smudge%20Filters&source=https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f&title=Replace%20sensitive%20information%20before%20committing%20PowerShell%20scripts%20using%20Git%20Clean%20and%20Smudge%20Filters"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters on whatsapp" href="https://api.whatsapp.com/send?text=Replace%20sensitive%20information%20before%20committing%20PowerShell%20scripts%20using%20Git%20Clean%20and%20Smudge%20Filters%20-%20https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Replace sensitive information before committing PowerShell scripts using Git Clean and Smudge Filters on telegram" href="https://telegram.me/share/url?text=Replace%20sensitive%20information%20before%20committing%20PowerShell%20scripts%20using%20Git%20Clean%20and%20Smudge%20Filters&url=https%3a%2f%2fwrite-verbose.com%2f2023%2f08%2f20%2fGitClean%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://write-verbose.com/>Write-Verbose</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>